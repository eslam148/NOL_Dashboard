<div class="branch-form-container">
  <!-- Header -->
  <div class="page-header">
    <div class="flex items-center gap-4">
      <button class="btn btn-ghost btn-sm" (click)="onCancel()">
        <i class="bi bi-arrow-left"></i>
        {{ 'common.back' | translate }}
      </button>
      <div>
        <h1 class="page-title">
          {{ isEditMode() ? ('branches.editBranch' | translate) : ('branches.addBranch' | translate) }}
        </h1>
        <p class="page-subtitle">
          {{ isEditMode() ? ('branches.editBranchDesc' | translate) : ('branches.addBranchDesc' | translate) }}
        </p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading()">
    <div class="spinner"></div>
    <p class="text-muted">{{ 'common.loading' | translate }}</p>
  </div>

  <!-- Error Message -->
  <div class="alert alert-error" *ngIf="errorMessage()">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <span>{{ errorMessage() }}</span>
  </div>

  <!-- Form -->
  <form [formGroup]="branchForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading()">
    <div class="form-sections">
      <!-- Basic Information -->
      <div class="form-section">
        <h2 class="section-title">{{ 'branches.basicInfo' | translate }}</h2>
        
        <div class="form-grid">
          <!-- Branch Name Arabic -->
          <div class="form-group">
            <label for="nameAr" class="form-label required">{{ 'branches.nameAr' | translate }}</label>
            <input
              id="nameAr"
              type="text"
              formControlName="nameAr"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('nameAr')"
              [placeholder]="'branches.nameArPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('nameAr')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('nameAr') }}
            </div>
          </div>

          <!-- Branch Name English -->
          <div class="form-group">
            <label for="nameEn" class="form-label required">{{ 'branches.nameEn' | translate }}</label>
            <input
              id="nameEn"
              type="text"
              formControlName="nameEn"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('nameEn')"
              [placeholder]="'branches.nameEnPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('nameEn')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('nameEn') }}
            </div>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label for="isActive" class="form-label required">{{ 'branches.status' | translate }}</label>
            <select
              id="isActive"
              formControlName="isActive"
              class="form-select focus-ring"
              [class.error]="isFieldInvalid('isActive')"
            >
              <option [value]="true">{{ 'common.status.active' | translate }}</option>
              <option [value]="false">{{ 'common.status.inactive' | translate }}</option>
            </select>
            <div class="form-error" *ngIf="isFieldInvalid('isActive')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('isActive') }}
            </div>
          </div>
        </div>

        <!-- Description Fields -->
        <div class="form-grid">
          <!-- Description Arabic -->
          <div class="form-group">
            <label for="descriptionAr" class="form-label">{{ 'branches.descriptionAr' | translate }}</label>
            <textarea
              id="descriptionAr"
              formControlName="descriptionAr"
              class="form-textarea focus-ring"
              rows="3"
              [placeholder]="'branches.descriptionArPlaceholder' | translate"
            ></textarea>
          </div>

          <!-- Description English -->
          <div class="form-group">
            <label for="descriptionEn" class="form-label">{{ 'branches.descriptionEn' | translate }}</label>
            <textarea
              id="descriptionEn"
              formControlName="descriptionEn"
              class="form-textarea focus-ring"
              rows="3"
              [placeholder]="'branches.descriptionEnPlaceholder' | translate"
            ></textarea>
          </div>
        </div>

        <div class="form-grid">
          <!-- Address -->
          <div class="form-group span-2">
            <label for="address" class="form-label required">{{ 'branches.address' | translate }}</label>
            <input
              id="address"
              type="text"
              formControlName="address"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('address')"
              [placeholder]="'branches.addressPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('address')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('address') }}
            </div>
          </div>
        </div>

        <div class="form-grid">
          <!-- City -->
          <div class="form-group">
            <label for="city" class="form-label required">{{ 'branches.city' | translate }}</label>
            <input
              id="city"
              type="text"
              formControlName="city"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('city')"
              [placeholder]="'branches.cityPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('city')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('city') }}
            </div>
          </div>

          <!-- Country -->
          <div class="form-group">
            <label for="country" class="form-label required">{{ 'branches.country' | translate }}</label>
            <input
              id="country"
              type="text"
              formControlName="country"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('country')"
              [placeholder]="'branches.countryPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('country')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('country') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div class="form-section">
        <h2 class="section-title">{{ 'branches.contactInfo' | translate }}</h2>
        
        <div class="form-grid">
          <!-- Phone -->
          <div class="form-group">
            <label for="phone" class="form-label required">{{ 'branches.phone' | translate }}</label>
            <input
              id="phone"
              type="tel"
              formControlName="phone"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('phone')"
              [placeholder]="'branches.phonePlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('phone')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('phone') }}
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="email" class="form-label required">{{ 'branches.email' | translate }}</label>
            <input
              id="email"
              type="email"
              formControlName="email"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('email')"
              [placeholder]="'branches.emailPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('email')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('email') }}
            </div>
          </div>
        </div>


      </div>

      <!-- Location -->
      <div class="form-section">
        <h2 class="section-title">{{ 'branches.location' | translate }}</h2>
        
        <div class="form-grid">
          <!-- Latitude -->
          <div class="form-group">
            <label for="latitude" class="form-label required">{{ 'branches.latitude' | translate }}</label>
            <input
              id="latitude"
              type="number"
              step="0.000001"
              formControlName="latitude"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('latitude')"
              [placeholder]="'branches.latitudePlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('latitude')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('latitude') }}
            </div>
          </div>

          <!-- Longitude -->
          <div class="form-group">
            <label for="longitude" class="form-label required">{{ 'branches.longitude' | translate }}</label>
            <input
              id="longitude"
              type="number"
              step="0.000001"
              formControlName="longitude"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('longitude')"
              [placeholder]="'branches.longitudePlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('longitude')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('longitude') }}
            </div>
          </div>
        </div>

        <div class="location-actions">
          <button type="button" class="btn btn-secondary" (click)="getCurrentLocation()">
            <i class="bi bi-geo-alt"></i>
            {{ 'branches.getCurrentLocation' | translate }}
          </button>
          <p class="text-sm text-secondary">{{ 'branches.mapInstructions' | translate }}</p>
        </div>

        <!-- Map Placeholder -->
        <div class="map-container">
          <div class="map-placeholder">
            <i class="bi bi-map"></i>
            <p>{{ 'branches.mapPlaceholder' | translate }}</p>
          </div>
        </div>
      </div>

      <!-- Working Hours and Additional Information -->
      <div class="form-section">
        <h2 class="section-title">{{ 'branches.additionalInfo' | translate }}</h2>

        <div class="form-grid">
          <!-- Working Hours -->
          <div class="form-group">
            <label for="workingHours" class="form-label required">{{ 'branches.workingHours' | translate }}</label>
            <input
              id="workingHours"
              type="text"
              formControlName="workingHours"
              class="form-input focus-ring"
              [class.error]="isFieldInvalid('workingHours')"
              [placeholder]="'branches.workingHoursPlaceholder' | translate"
            />
            <div class="form-error" *ngIf="isFieldInvalid('workingHours')">
              <i class="bi bi-exclamation-circle"></i>
              {{ getFieldError('workingHours') }}
            </div>
          </div>

          <!-- Assigned Staff IDs -->
          <div class="form-group">
            <label for="assignedStaffIds" class="form-label">{{ 'branches.assignedStaff' | translate }}</label>
            <input
              id="assignedStaffIds"
              type="text"
              formControlName="assignedStaffIds"
              class="form-input focus-ring"
              [placeholder]="'branches.assignedStaffPlaceholder' | translate"
              readonly
            />
            <small class="form-help">{{ 'branches.assignedStaffHelp' | translate }}</small>
          </div>
        </div>

        <!-- Notes -->
        <div class="form-group">
          <label for="notes" class="form-label">{{ 'branches.notes' | translate }}</label>
          <textarea
            id="notes"
            formControlName="notes"
            class="form-textarea focus-ring"
            rows="4"
            [placeholder]="'branches.notesPlaceholder' | translate"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        <i class="bi bi-x-circle"></i>
        {{ 'common.cancel' | translate }}
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="branchForm.invalid || isSaving()"
      >
        <div class="spinner" *ngIf="isSaving()"></div>
        <i class="bi bi-check-circle" *ngIf="!isSaving()"></i>
        {{ isSaving() ? ('common.saving' | translate) : ('common.save' | translate) }}
      </button>
    </div>
  </form>
</div>
